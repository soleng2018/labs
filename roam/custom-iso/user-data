#cloud-config
autoinstall:
  version: 1
  
  # Early commands to run before installation
  early-commands:
    - echo "Starting autoinstall process"
  
  # Locale and keyboard settings
  locale: en_US.UTF-8
  keyboard:
    layout: us
  
  # Network configuration - skip network setup during install, use wpa_supplicant instead
  network:
    version: 2
  
  # Identity configuration
  identity:
    realname: WiFi Roaming User
    username: wifiroam
    password: $6$FspnpTnwGF.Bgzj/$N9mWzRiNB02OGFdATLF254qZvsEnwWEQb9o9paJNWuq4MufxD0RM6645ctNhIj4Wx68m196R6AFoU5sZBQj6g1
    hostname: wifi-roaming-system
  
  # SSH configuration - enable for remote access
  ssh:
    install-server: true
    authorized-keys: []
  
  # Package configuration
  packages:
    # SSH server for remote access
    - openssh-server
    # Essential WiFi packages
    - wpasupplicant
    - dhcpcd5
    - iw
    - wireless-tools
    # Network testing tools
    - speedtest-cli
    # System utilities
    - curl
    - wget
    - systemd
    # Development tools (optional)
    - git
    - vim
    - nano
    
  # Disable automatic package updates to prevent interference during install
  # (Updates handled post-installation by the system)
  
  # Storage configuration - use entire disk
  storage:
    layout:
      name: direct
      match:
        size: largest
  
  # Timezone
  timezone: UTC
  
  # Boot configuration handled by installer defaults
  
  # Late commands to run after installation but before reboot
  late-commands:
    # Ensure SSH is enabled and will start on boot
    - curtin in-target -- systemctl enable ssh
    - curtin in-target -- systemctl enable openssh-server
    # Remove CDROM from APT sources and ensure internet repositories are used
    - curtin in-target -- sed -i '/cdrom:/d' /etc/apt/sources.list
    - curtin in-target -- apt-get update
  
  # Directory creation and permissions handled by wifi_roam_setup.sh on first boot
    
  # Power state after installation
  shutdown: reboot
